# æ›´æ–°æ—¥å¿— v1.6+

## v1.0.7 (2026-02-01)

### ä¿®å¤
*   **å›¾ç‰‡å±•ç¤º**: ä¿®å¤ Windows ä¸­æ–‡è·¯å¾„å›¾ç‰‡æ— æ³•æ˜¾ç¤ºé—®é¢˜
*   **Unicode æ”¯æŒ**: è‡ªå®šä¹‰é™æ€æ–‡ä»¶è·¯ç”±ç¡®ä¿éž ASCII è·¯å¾„æ­£å¸¸è®¿é—®
*   **æ•°æ®åº“**: æ·»åŠ  web_processed_path/web_raw_path åˆ—è‡ªåŠ¨è¿ç§»

---

## v1.6 (2025-xx-xx)

### ðŸš€ æ–°å¢žåŠŸèƒ½

### 1. æ™ºèƒ½é€’å½’æ‰«æä¸Žå‰ªæž (Smart Scanning)
*   **åŠŸèƒ½**: å®žçŽ°äº†é€’å½’ç›®å½•æ‰«æå™¨ã€‚
*   **å‰ªæžä¼˜åŒ–**: æ”¯æŒåŸºäºŽæ—¥æœŸçš„â€œæ™ºèƒ½å‰ªæžâ€ã€‚å¦‚æžœæŒ‡å®šäº† `start_date` æˆ– `end_date`ï¼Œç³»ç»Ÿä¼šç›´æŽ¥è·³è¿‡æ—¥æœŸèŒƒå›´ä¹‹å¤–çš„æ–‡ä»¶å¤¹ï¼Œæžå¤§æå‡äº†æ‰«ææ•ˆçŽ‡ã€‚
*   **è§£æžé€»è¾‘**:
    *   **çˆ¶çº§æ–‡ä»¶å¤¹**: å¼ºåˆ¶é‡‡ç”¨ `yyyyMMdd-yyyyMMdd...` æˆ– `yyyyMMdd...` çš„æ ‡å‡†æ ¼å¼è§£æžã€‚
    *   **ä½ç½®å‰ç¼€**: çˆ¶æ–‡ä»¶å¤¹çš„åœ°ç‚¹ä¿¡æ¯ä¼šè‡ªåŠ¨ä½œä¸ºå‰ç¼€æ‹¼æŽ¥åˆ°å­æ–‡ä»¶å¤¹åœ°ç‚¹ä¸­ï¼ˆä¾‹å¦‚ï¼šçˆ¶ `2023_æ—¥æœ¬` + å­ `ä¸œäº¬` -> åœ°ç‚¹ `æ—¥æœ¬_ä¸œäº¬`ï¼‰ã€‚
    *   **æ··åˆè§£æž**: `config` ä¸­çš„è‡ªå®šä¹‰æ­£åˆ™ (`structure_pattern`) çŽ°åœ¨**ä»…ä½œç”¨äºŽæœ€åŽä¸€å±‚æ–‡ä»¶å¤¹**ï¼Œæ—¢ä¿è¯äº†çˆ¶çº§ç»“æž„çš„è§„èŒƒæ€§ï¼Œåˆä¿ç•™äº†æœ«çº§æ–‡ä»¶å¤¹å‘½åçš„çµæ´»æ€§ã€‚

### 2. å¤‡é€‰ç»“æžœä¸Žäººå·¥æ ¡å¯¹
*   **AI å¤‡é€‰**: ç³»ç»ŸçŽ°åœ¨ä¼šå°† Top 5ï¼ˆå¯é€šè¿‡ `top_k` é…ç½®ï¼‰è¯†åˆ«ç»“æžœå­˜å…¥æ•°æ®åº“ (`candidates_json` å­—æ®µ)ã€‚
*   **é˜ˆå€¼æŽ§åˆ¶**: å¼•å…¥ `recognition.alternatives_threshold` (é»˜è®¤ 70)ã€‚
    *   è‹¥ AI ç½®ä¿¡åº¦ > 70%ï¼ŒEXIF å¤‡æ³¨ä»…å†™å…¥é¦–é€‰ç»“æžœã€‚
    *   è‹¥ < 70%ï¼ŒEXIF å¤‡æ³¨ä¼šåˆ—å‡ºæ‰€æœ‰å¤‡é€‰é¡¹ä¾›å‚è€ƒã€‚
*   **Web äº¤äº’**:
    *   â€œä¿®æ­£ IDâ€å¼¹çª—ä¸­æ–°å¢žäº† **"AI å¤‡é€‰ (Alternatives)"** åˆ—è¡¨ï¼Œç‚¹å‡»å³å¯ä¸€é”®ä¿®æ­£ã€‚
*   **æ™ºèƒ½é‡å‘½å**:
    *   å½“äººå·¥ä¿®æ­£ç‰©ç§åæ—¶ï¼Œå¦‚æžœæ–‡ä»¶åæ¨¡ç‰ˆåŒ…å« `{species_cn}`ã€`{species_sci}` æˆ– `{confidence}`ï¼Œæ–‡ä»¶ä¼šè¢«**è‡ªåŠ¨é‡å‘½åå¹¶ç§»åŠ¨**åˆ°æ­£ç¡®è·¯å¾„ã€‚
    *   æ–‡ä»¶åä¸­çš„ç½®ä¿¡åº¦ä¼šè‡ªåŠ¨æ›´æ–°ä¸º `100pct` ä»¥ä½“çŽ°äººå·¥ç¡®è®¤çš„çŠ¶æ€ã€‚

### 3. NAS / WebDAV æ”¯æŒ
*   **æ”¯æŒ**: ç¡®è®¤æ”¯æŒé€šè¿‡æ“ä½œç³»ç»ŸæŒ‚è½½çš„ WebDAV/SMB ç½‘ç»œé©±åŠ¨å™¨ã€‚
*   **æ–‡æ¡£**: æ–°å¢ž `docs/NAS_SETUP_zh.md`ï¼Œæä¾›è¯¦ç»†çš„æŒ‚è½½æŒ‡å—ã€‚

## ðŸ› ï¸ æ”¹è¿›ä¸Žä¿®å¤

### å…ƒæ•°æ® (EXIF/IPTC/XMP)
*   **æ ¼å¼ç»Ÿä¸€**: å°† "Title" å’Œ "Description" å­—æ®µç»Ÿä¸€æ ¼å¼åŒ–ä¸º `ä¸­æ–‡å (æ‹‰ä¸å)`ã€‚
*   **Subject å­—æ®µ**: æ˜¾å¼æ¸…ç©º `XPSubject` å­—æ®µï¼Œé¿å…åœ¨ Windows èµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤ºé‡å¤æˆ–å†—ä½™ä¿¡æ¯ã€‚
*   **ç¼–ç ä¿®å¤**: é€šè¿‡å°†æ–‡ä»¶åæ”¾å…¥å‚æ•°æ–‡ä»¶ (`argfile`) ä¼ é€’ï¼Œå½»åº•è§£å†³äº† Windows CLI ä¸‹çš„ä¸­æ–‡è·¯å¾„ç¼–ç é—®é¢˜ã€‚
*   **å®‰å…¨æ€§**: ä½¿ç”¨ `-E` æ ‡å¿—å’Œ HTML å®žä½“ (`&#xa;`) å®‰å…¨å¤„ç†å¤‡æ³¨ä¸­çš„æ¢è¡Œç¬¦ã€‚

### é…ç½®ä¸Žé€»è¾‘
*   **æ­£åˆ™ä¼˜åŒ–**: ä¿®æ­£äº† `structure_pattern` çš„è´ªå©ªåŒ¹é…é—®é¢˜ï¼Œé˜²æ­¢å…¶é”™è¯¯åžå™¬çˆ¶çº§ç›®å½•è·¯å¾„ã€‚
*   **Top-K**: ç¡®ä¿æœ¬åœ°æ¨¡åž‹å’Œ API æ¨¡å¼å‡æ”¯æŒ `top_k` å‚æ•°é…ç½®ã€‚

### æ•°æ®åº“
*   **æ‰«æåŽ†å²**: æ–°å¢ž `scan_history` è¡¨ï¼Œè®°å½•æ¯æ¬¡ä»»åŠ¡çš„è€—æ—¶ã€å¤„ç†æ•°é‡å’Œæ—¥æœŸèŒƒå›´ã€‚
*   **è‡ªåŠ¨è¿ç§»**: å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶æ·»åŠ  `candidates_json` åˆ—ï¼Œæ— éœ€æ‰‹åŠ¨å‡çº§æ•°æ®åº“ã€‚

## ðŸ‘¨â€ðŸ’» å¼€å‘å¤‡æ³¨
*   **é‡æž„**: å°†æ–‡ä»¶å¤¹æ—¥æœŸè§£æžé€»è¾‘æå–ä¸º `PathParser.parse_folder_name` é™æ€æ–¹æ³•ï¼Œä¾¿äºŽå¤ç”¨ã€‚
*   **API**: å‡çº§ `/api/update_label` æŽ¥å£ï¼Œä½¿å…¶å…·å¤‡æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆç§»åŠ¨/é‡å‘½åï¼‰å’Œ EXIF å›žå†™èƒ½åŠ›ã€‚

---

## ðŸ› ä¿®å¤ (v1.6 ä¹‹åŽ)

### Web ç•Œé¢æ”¹è¿›
*   **ç¿»é¡µä¸€è‡´æ€§**: ä¿®å¤äº†é¡¶éƒ¨å’Œåº•éƒ¨ç¿»é¡µæŒ‰é’®è¡Œä¸ºä¸ä¸€è‡´çš„é—®é¢˜ã€‚çŽ°åœ¨ä¸¤è€…éƒ½ä½¿ç”¨åŠ¨æ€ JavaScript æ¸²æŸ“ï¼ŒçŠ¶æ€åŒæ­¥æ­£å¸¸ã€‚
*   **Limit åŒæ­¥**: ä¿®å¤ `currentLimit` å˜é‡ï¼Œä»ŽæœåŠ¡å™¨åŒæ­¥ limit å€¼è€Œéžç¡¬ç¼–ç  50ã€‚
*   **å¸ƒå±€ä¿®å¤**: ä½¿ç”¨ CSS Grid æ›¿æ¢è¡¨æ ¼å¸ƒå±€æ˜¾ç¤ºç…§ç‰‡ç”»å»Šï¼Œæ— è®ºæœ€åŽä¸€è¡Œæœ‰å¤šå°‘å¼ ç…§ç‰‡ï¼Œéƒ½èƒ½ä¿æŒ4åˆ—ç­‰å®½æ˜¾ç¤ºã€‚
*   **åˆ†ç±»æ ‘å¸ƒå±€**: è°ƒæ•´ä¾§è¾¹æ å®½åº¦ä¸º `col-md-3` (25%)ï¼Œä¸Žç…§ç‰‡ç½‘æ ¼æ›´å¹³è¡¡ã€‚

### æŠ€æœ¯ç»†èŠ‚
```javascript
// ä¿®æ”¹å‰ï¼šç¡¬ç¼–ç  limit
let currentLimit = 50;

// ä¿®æ”¹åŽï¼šä»ŽæœåŠ¡å™¨åŒæ­¥ limit
let currentLimit = {{ limit }};

// CSS Grid ç¡®ä¿ç…§ç‰‡ç­‰å®½
.photo-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
}
```

### å›¾ç‰‡å±•ç¤ºä¿®å¤
*   **Unicode è·¯å¾„æ”¯æŒ**: ä¿®å¤äº† Windows ä¸Š Web ç•Œé¢æ— æ³•æ˜¾ç¤ºåŒ…å«ä¸­æ–‡ç­‰éž ASCII å­—ç¬¦è·¯å¾„å›¾ç‰‡çš„é—®é¢˜ã€‚
*   **è·¯å¾„è§„èŒƒåŒ–**: åœ¨ `resolve_web_path` å’Œ `resolve_processed_web_path` å‡½æ•°ä¸­æ·»åŠ è·¯å¾„åˆ†éš”ç¬¦è§„èŒƒåŒ–å¤„ç†ï¼Œå°†åæ–œæ ç»Ÿä¸€è½¬æ¢ä¸ºæ­£æ–œæ ã€‚
*   **è‡ªå®šä¹‰é™æ€æ–‡ä»¶æœåŠ¡**: ä¸º `/static/processed/` è·¯ç”±æ·»åŠ è‡ªå®šä¹‰å¤„ç†å™¨ï¼Œè§£å†³ FastAPI StaticFiles å¯¹ Unicode è·¯å¾„æ”¯æŒä¸ä½³çš„é—®é¢˜ã€‚
*   **æ•°æ®åº“è¿ç§»**: æ·»åŠ  `web_processed_path` å’Œ `web_raw_path` åˆ—çš„è‡ªåŠ¨è¿ç§»æ”¯æŒã€‚

### æŠ€æœ¯ç»†èŠ‚
```python
# ä¿®æ”¹å‰ï¼šç›´æŽ¥ä½¿ç”¨ Path å¯èƒ½å¯¼è‡´è½¬ä¹‰é—®é¢˜
abs_path = Path(file_path_str).resolve()

# ä¿®æ”¹åŽï¼šå…ˆè§„èŒƒåŒ–è·¯å¾„åˆ†éš”ç¬¦
normalized = file_path_str.replace('\\', '/')
abs_path = Path(normalized).resolve()
```

```python
# è‡ªå®šä¹‰è·¯ç”±å¤„ç† Unicode è·¯å¾„
@app.get("/static/processed/{path:path}")
def serve_processed_file(path: str):
    full_path = processed_dir / path.replace('/', os.sep)
    if full_path.exists() and full_path.is_file():
        return FileResponse(full_path)
    raise HTTPException(status_code=404, detail="File not found")
```
